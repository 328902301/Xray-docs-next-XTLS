import{g as e,p as t,b as r}from"./add-html-label.b4f23f52.js";import{l as a,h as o,c as n,t as s,p as l,q as i,j as d,r as c,o as p}from"./mermaid.core.959a1563.js";import{i as h,a as b,b as u}from"./edges-02da71a2.17db7876.js";import{l as g}from"./isPlainObject.3ac82de7.js";import"./app.9b9e67e9.js";import"./svgDraw-87c143cd.41821436.js";import"./array.999c8e45.js";import"./constant.4f073c13.js";let y;const w={},f={};let k={};const x=(e,t,r)=>{const o={TB:{in:{north:"north"},out:{south:"west",west:"east",east:"south"}},LR:{in:{west:"west"},out:{east:"south",south:"north",north:"east"}},RL:{in:{east:"east"},out:{west:"north",north:"south",south:"west"}},BT:{in:{south:"south"},out:{north:"east",east:"west",west:"north"}}};return o.TD=o.TB,a.info("abc88",r,t,e),o[r][t][e]},m=(e,t,r)=>{if(a.info("getNextPort abc88",{node:e,edgeDirection:t,graphDirection:r}),!w[e])switch(r){case"TB":case"TD":w[e]={inPosition:"north",outPosition:"south"};break;case"BT":w[e]={inPosition:"south",outPosition:"north"};break;case"RL":w[e]={inPosition:"east",outPosition:"west"};break;case"LR":w[e]={inPosition:"west",outPosition:"east"}}const o="in"===t?w[e].inPosition:w[e].outPosition;return"in"===t?w[e].inPosition=x(w[e].inPosition,t,r):w[e].outPosition=x(w[e].outPosition,t,r),o},v=function(e,t,r,o){a.info("abc78 edges = ",e);const n=o.insert("g").attr("class","edgeLabels");let s,i,h={},b=t.db.getDirection();if(void 0!==e.defaultStyle){const t=l(e.defaultStyle);s=t.style,i=t.labelStyle}return e.forEach((function(t){var o="L-"+t.start+"-"+t.end;void 0===h[o]?(h[o]=0,a.info("abc78 new entry",o,h[o])):(h[o]++,a.info("abc78 new entry",o,h[o]));let g=o+"-"+h[o];a.info("abc78 new link id to be used is",o,g,h[o]);var y="LS-"+t.start,w="LE-"+t.end;const x={style:"",labelStyle:""};switch(x.minlen=t.length||1,"arrow_open"===t.type?x.arrowhead="none":x.arrowhead="normal",x.arrowTypeStart="arrow_open",x.arrowTypeEnd="arrow_open",t.type){case"double_arrow_cross":x.arrowTypeStart="arrow_cross";case"arrow_cross":x.arrowTypeEnd="arrow_cross";break;case"double_arrow_point":x.arrowTypeStart="arrow_point";case"arrow_point":x.arrowTypeEnd="arrow_point";break;case"double_arrow_circle":x.arrowTypeStart="arrow_circle";case"arrow_circle":x.arrowTypeEnd="arrow_circle"}let v="",E="";switch(t.stroke){case"normal":v="fill:none;",void 0!==s&&(v=s),void 0!==i&&(E=i),x.thickness="normal",x.pattern="solid";break;case"dotted":x.thickness="normal",x.pattern="dotted",x.style="fill:none;stroke-width:2px;stroke-dasharray:3;";break;case"thick":x.thickness="thick",x.pattern="solid",x.style="stroke-width: 3.5px;fill:none;"}if(void 0!==t.style){const e=l(t.style);v=e.style,E=e.labelStyle}x.style=x.style+=v,x.labelStyle=x.labelStyle+=E,void 0!==t.interpolate?x.curve=c(t.interpolate,p):void 0!==e.defaultInterpolate?x.curve=c(e.defaultInterpolate,p):x.curve=c(f.curve,p),void 0===t.text?void 0!==t.style&&(x.arrowheadStyle="fill: #333"):(x.arrowheadStyle="fill: #333",x.labelpos="c"),x.labelType="text",x.label=t.text.replace(d.lineBreakRegex,"\n"),void 0===t.style&&(x.style=x.style||"stroke: #333; stroke-width: 1.5px;fill:none;"),x.labelStyle=x.labelStyle.replace("color:","fill:"),x.id=g,x.classes="flowchart-link "+y+" "+w;const S=u(n,x),{source:_,target:$}=((e,t)=>{let r=e.start,a=e.end;const o=k[r],n=k[a];return o&&n?("diamond"===o.type&&(r=`${r}-${m(r,"out",t)}`),"diamond"===n.type&&(a=`${a}-${m(a,"in",t)}`),{source:r,target:a}):{source:r,target:a}})(t,b);a.debug("abc78 source and target",_,$),r.edges.push({id:"e"+t.start+t.end,sources:[_],targets:[$],labelEl:S,labels:[{width:x.width,height:x.height,orgWidth:x.width,orgHeight:x.height,text:x.label,layoutOptions:{"edgeLabels.inline":"true","edgeLabels.placement":"CENTER"}}],edgeData:x})})),r},E=function(e,t,r){const a=((e,t,r)=>{const{parentById:a}=r,o=new Set;let n=e;for(;n;){if(o.add(n),n===t)return n;n=a[n]}for(n=t;n;){if(o.has(n))return n;n=a[n]}return"root"})(e,t,r);if(void 0===a||"root"===a)return{x:0,y:0};const o=k[a].offset;return{x:o.posX,y:o.posY}},S=function(e,t,r,a,n){const s=E(t.sources[0],t.targets[0],n),l=t.sections[0].startPoint,i=t.sections[0].endPoint,d=(t.sections[0].bendPoints?t.sections[0].bendPoints:[]).map((e=>[e.x+s.x,e.y+s.y])),c=[[l.x+s.x,l.y+s.y],...d,[i.x+s.x,i.y+s.y]],h=g().curve(p),b=e.insert("path").attr("d",h(c)).attr("class","path").attr("fill","none"),u=e.insert("g").attr("class","edgeLabel"),y=o(u.node().appendChild(t.labelEl)),w=y.node().firstChild.getBoundingClientRect();y.attr("width",w.width),y.attr("height",w.height),u.attr("transform",`translate(${t.labels[0].x+s.x}, ${t.labels[0].y+s.y})`),function(e,t,r,a){let o="";switch(a&&(o=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,o=o.replace(/\(/g,"\\("),o=o.replace(/\)/g,"\\)")),t.arrowTypeStart){case"arrow_cross":e.attr("marker-start","url("+o+"#"+r+"-crossStart)");break;case"arrow_point":e.attr("marker-start","url("+o+"#"+r+"-pointStart)");break;case"arrow_barb":e.attr("marker-start","url("+o+"#"+r+"-barbStart)");break;case"arrow_circle":e.attr("marker-start","url("+o+"#"+r+"-circleStart)");break;case"aggregation":e.attr("marker-start","url("+o+"#"+r+"-aggregationStart)");break;case"extension":e.attr("marker-start","url("+o+"#"+r+"-extensionStart)");break;case"composition":e.attr("marker-start","url("+o+"#"+r+"-compositionStart)");break;case"dependency":e.attr("marker-start","url("+o+"#"+r+"-dependencyStart)");break;case"lollipop":e.attr("marker-start","url("+o+"#"+r+"-lollipopStart)")}switch(t.arrowTypeEnd){case"arrow_cross":e.attr("marker-end","url("+o+"#"+r+"-crossEnd)");break;case"arrow_point":e.attr("marker-end","url("+o+"#"+r+"-pointEnd)");break;case"arrow_barb":e.attr("marker-end","url("+o+"#"+r+"-barbEnd)");break;case"arrow_circle":e.attr("marker-end","url("+o+"#"+r+"-circleEnd)");break;case"aggregation":e.attr("marker-end","url("+o+"#"+r+"-aggregationEnd)");break;case"extension":e.attr("marker-end","url("+o+"#"+r+"-extensionEnd)");break;case"composition":e.attr("marker-end","url("+o+"#"+r+"-compositionEnd)");break;case"dependency":e.attr("marker-end","url("+o+"#"+r+"-dependencyEnd)");break;case"lollipop":e.attr("marker-end","url("+o+"#"+r+"-lollipopEnd)")}}(b,r,a.type,a.arrowMarkerAbsolute)},_=(e,t)=>{e.forEach((e=>{e.children||(e.children=[]);const r=t.childrenById[e.id];r&&r.forEach((t=>{e.children.push(k[t])})),_(e.children,t)}))},$=(e,t,r,o,n,s,l)=>{r.forEach((function(r){if(r)if(k[r.id].offset={posX:r.x+e,posY:r.y+t,x:e,y:t,depth:l,width:r.width,height:r.height},"group"===r.type){const o=n.insert("g").attr("class","subgraph");o.insert("rect").attr("class","subgraph subgraph-lvl-"+l%5+" node").attr("x",r.x+e).attr("y",r.y+t).attr("width",r.width).attr("height",r.height);const s=o.insert("g").attr("class","label");s.attr("transform",`translate(${r.labels[0].x+e+r.x}, ${r.labels[0].y+t+r.y})`),s.node().appendChild(r.labelData.labelNode),a.info("Id (UGH)= ",r.type,r.labels)}else a.info("Id (UGH)= ",r.id),r.el.attr("transform",`translate(${r.x+e+r.width/2}, ${r.y+t+r.height/2})`)})),r.forEach((function(r){r&&"group"===r.type&&$(e+r.x,t+r.y,r.children,o,n,s,l+1)}))},T={db:e,renderer:{getClasses:function(e,t){a.info("Extracting classes"),t.db.clear("ver-2");try{return t.parse(e),t.db.getClasses()}catch(r){return{}}},draw:async function(e,t,c,p){var u;if(!y){const e=(await import("./elk.bundled.a3452741.js").then((function(e){return e.e}))).default;y=new e}p.db.clear(),k={},p.db.setGen("gen-2"),p.parser.parse(e);const g=o("body").append("div").attr("style","height:400px").attr("id","cy");let w={id:"root",layoutOptions:{"elk.hierarchyHandling":"INCLUDE_CHILDREN","org.eclipse.elk.padding":"[top=100, left=100, bottom=110, right=110]","elk.layered.spacing.edgeNodeBetweenLayers":"30","elk.direction":"DOWN"},children:[],edges:[]};switch(a.info("Drawing flowchart using v3 renderer",y),p.db.getDirection()){case"BT":w.layoutOptions["elk.direction"]="UP";break;case"TB":w.layoutOptions["elk.direction"]="DOWN";break;case"LR":w.layoutOptions["elk.direction"]="RIGHT";break;case"RL":w.layoutOptions["elk.direction"]="LEFT"}const{securityLevel:f,flowchart:x}=n();let m;"sandbox"===f&&(m=o("#i"+t));const E=o("sandbox"===f?m.nodes()[0].contentDocument.body:"body"),T="sandbox"===f?m.nodes()[0].contentDocument:document,B=E.select(`[id="${t}"]`);h(B,["point","circle","cross"],p.type,p.arrowMarkerAbsolute);const C=p.db.getVertices();let I;const P=p.db.getSubGraphs();a.info("Subgraphs - ",P);for(let r=P.length-1;r>=0;r--)I=P[r],p.db.addVertex(I.id,I.title,"group",void 0,I.classes,I.dir);const D=B.insert("g").attr("class","subgraphs"),L=function(e){const t={parentById:{},childrenById:{}},r=e.getSubGraphs();return a.info("Subgraphs - ",r),r.forEach((function(e){e.nodes.forEach((function(r){t.parentById[r]=e.id,void 0===t.childrenById[e.id]&&(t.childrenById[e.id]=[]),t.childrenById[e.id].push(r)}))})),r.forEach((function(e){e.id,void 0!==t.parentById[e.id]&&t.parentById[e.id]})),t}(p.db);w=function(e,t,a,o,s,c,p){const h=a.select(`[id="${t}"]`),u=h.insert("g").attr("class","nodes");return Object.keys(e).forEach((function(t){const a=e[t];let p="default";a.classes.length>0&&(p=a.classes.join(" "));const g=l(a.styles);let y,w=void 0!==a.text?a.text:a.id;const f={width:0,height:0};if(i(n().flowchart.htmlLabels)){const e={label:w.replace(/fa[blrs]?:fa-[\w-]+/g,(e=>`<i class='${e.replace(":"," ")}'></i>`))};y=r(h,e).node();const t=y.getBBox();f.width=t.width,f.height=t.height,f.labelNode=y,y.parentNode.removeChild(y)}else{const e=o.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("style",g.labelStyle.replace("color:","fill:"));const t=w.split(d.lineBreakRegex);for(const a of t){const t=o.createElementNS("http://www.w3.org/2000/svg","tspan");t.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),t.setAttribute("dy","1em"),t.setAttribute("x","1"),t.textContent=a,e.appendChild(t)}y=e;const r=y.getBBox();f.width=r.width,f.height=r.height,f.labelNode=y}const x=[{id:a.id+"-west",layoutOptions:{"port.side":"WEST"}},{id:a.id+"-east",layoutOptions:{"port.side":"EAST"}},{id:a.id+"-south",layoutOptions:{"port.side":"SOUTH"}},{id:a.id+"-north",layoutOptions:{"port.side":"NORTH"}}];let m=0,v="",E={};switch(a.type){case"round":m=5,v="rect";break;case"square":v="rect";break;case"diamond":v="question",E={portConstraints:"FIXED_SIDE"};break;case"hexagon":v="hexagon";break;case"odd":v="rect_left_inv_arrow";break;case"lean_right":v="lean_right";break;case"lean_left":v="lean_left";break;case"trapezoid":v="trapezoid";break;case"inv_trapezoid":v="inv_trapezoid";break;case"odd_right":v="rect_left_inv_arrow";break;case"circle":v="circle";break;case"ellipse":v="ellipse";break;case"stadium":v="stadium";break;case"subroutine":v="subroutine";break;case"cylinder":v="cylinder";break;case"group":v="rect";break;case"doublecircle":v="doublecircle";break;default:v="rect"}const S={labelStyle:g.labelStyle,shape:v,labelText:w,rx:m,ry:m,class:p,style:g.style,id:a.id,link:a.link,linkTarget:a.linkTarget,tooltip:s.db.getTooltip(a.id)||"",domId:s.db.lookUpDomId(a.id),haveCallback:a.haveCallback,width:"group"===a.type?500:void 0,dir:a.dir,type:a.type,props:a.props,padding:n().flowchart.padding};let _,$;"group"!==S.type&&($=b(u,S,a.dir),_=$.node().getBBox());const T={id:a.id,ports:"diamond"===a.type?x:[],layoutOptions:E,labelText:w,labelData:f,domId:s.db.lookUpDomId(a.id),width:null==_?void 0:_.width,height:null==_?void 0:_.height,type:a.type,el:$,parent:c.parentById[a.id]};k[S.id]=T})),p}(C,t,E,T,p,L,w);const O=B.insert("g").attr("class","edges edgePath"),N=p.db.getEdges();w=v(N,p,w,B);Object.keys(k).forEach((e=>{const t=k[e];t.parent||w.children.push(t),void 0!==L.childrenById[e]&&(t.labels=[{text:t.labelText,layoutOptions:{"nodeLabels.placement":"[H_CENTER, V_TOP, INSIDE]"},width:t.labelData.width,height:t.labelData.height}],delete t.x,delete t.y,delete t.width,delete t.height)})),_(w.children,L),a.info("after layout",JSON.stringify(w,null,2));const j=await y.layout(w);$(0,0,j.children,B,D,p,0),a.info("after layout",j),null==(u=j.edges)||u.map((e=>{S(O,e,e.edgeData,p,L)})),s({},B,x.diagramPadding,x.useMaxWidth),g.remove()}},parser:t,styles:e=>`.label {\n    font-family: ${e.fontFamily};\n    color: ${e.nodeTextColor||e.textColor};\n  }\n  .cluster-label text {\n    fill: ${e.titleColor};\n  }\n  .cluster-label span {\n    color: ${e.titleColor};\n  }\n\n  .label text,span {\n    fill: ${e.nodeTextColor||e.textColor};\n    color: ${e.nodeTextColor||e.textColor};\n  }\n\n  .node rect,\n  .node circle,\n  .node ellipse,\n  .node polygon,\n  .node path {\n    fill: ${e.mainBkg};\n    stroke: ${e.nodeBorder};\n    stroke-width: 1px;\n  }\n\n  .node .label {\n    text-align: center;\n  }\n  .node.clickable {\n    cursor: pointer;\n  }\n\n  .arrowheadPath {\n    fill: ${e.arrowheadColor};\n  }\n\n  .edgePath .path {\n    stroke: ${e.lineColor};\n    stroke-width: 2.0px;\n  }\n\n  .flowchart-link {\n    stroke: ${e.lineColor};\n    fill: none;\n  }\n\n  .edgeLabel {\n    background-color: ${e.edgeLabelBackground};\n    rect {\n      opacity: 0.5;\n      background-color: ${e.edgeLabelBackground};\n      fill: ${e.edgeLabelBackground};\n    }\n    text-align: center;\n  }\n\n  .cluster rect {\n    fill: ${e.clusterBkg};\n    stroke: ${e.clusterBorder};\n    stroke-width: 1px;\n  }\n\n  .cluster text {\n    fill: ${e.titleColor};\n  }\n\n  .cluster span {\n    color: ${e.titleColor};\n  }\n  /* .cluster div {\n    color: ${e.titleColor};\n  } */\n\n  div.mermaidTooltip {\n    position: absolute;\n    text-align: center;\n    max-width: 200px;\n    padding: 2px;\n    font-family: ${e.fontFamily};\n    font-size: 12px;\n    background: ${e.tertiaryColor};\n    border: 1px solid ${e.border2};\n    border-radius: 2px;\n    pointer-events: none;\n    z-index: 100;\n  }\n\n  .flowchartTitleText {\n    text-anchor: middle;\n    font-size: 18px;\n    fill: ${e.textColor};\n  }\n  .subgraph {\n    stroke-width:2;\n    rx:3;\n  }\n  // .subgraph-lvl-1 {\n  //   fill:#ccc;\n  //   // stroke:black;\n  // }\n  ${(e=>{let t="";for(let r=0;r<5;r++)t+=`\n      .subgraph-lvl-${r} {\n        fill: ${e[`surface${r}`]};\n        stroke: ${e[`surfacePeer${r}`]};\n      }\n    `;return t})(e)}\n`};export{T as diagram};
